<form name="$ctrl.redeployGitForm" class="form-horizontal my-8">
  <div class="col-sm-12 form-section-title"> Redeploy from git repository </div>
  <git-form-info-panel
    class-name="text-muted small"
    url="$ctrl.model.URL"
    type="stack"
    config-file-path="$ctrl.model.ConfigFilePath"
    additional-files="$ctrl.stack.AdditionalFiles"
  ></git-form-info-panel>
  <git-form-auto-update-fieldset
    model="$ctrl.formValues.AutoUpdate"
    on-change="($ctrl.onChangeAutoUpdate)"
    show-force-pull-image="$ctrl.stack.Type !== 3"
  ></git-form-auto-update-fieldset>
  <time-window-display></time-window-display>

  <div class="form-group">
    <div class="col-sm-12">
      <p>
        <a class="small interactive" ng-click="$ctrl.state.showConfig = !$ctrl.state.showConfig">
          <i ng-class="{ 'fa fa-minus space-right': $ctrl.state.showConfig, 'fa fa-plus space-right': !$ctrl.state.showConfig }" aria-hidden="true"></i>
          {{ $ctrl.state.showConfig ? 'Hide' : 'Advanced' }} configuration
        </a>
      </p>
    </div>
  </div>
  <git-form-ref-field ng-if="$ctrl.state.showConfig" value="$ctrl.formValues.RefName" on-change="($ctrl.onChangeRef)" model="$ctrl.formValues"></git-form-ref-field>
  <git-form-auth-fieldset
    ng-if="$ctrl.state.showConfig"
    repository-authentication="$ctrl.formValues.RepositoryAuthentication"
    repository-username="$ctrl.formValues.RepositoryUsername"
    repository-password="$ctrl.formValues.RepositoryPassword"
    git-credentials="$ctrl.formValues.GitCredentials"
    selected-git-credential="$ctrl.formValues.SelectedGitCredential"
    save-credential="$ctrl.formValues.SaveCredential"
    new-credential-name="$ctrl.formValues.NewCredentialName"
    new-credential-name-exist="$ctrl.formValues.NewCredentialNameExist"
    new-credential-name-invalid="$ctrl.formValues.NewCredentialNameInvalid"
    on-select-git-credential="($ctrl.onSelectGitCredential)"
    on-change-repository-Authentication="($ctrl.onChangeRepositoryAuthentication)"
    on-change-save-credential="($ctrl.onChangeSaveCredential)"
    on-change-repository-username="($ctrl.onChangeRepositoryUsername)"
    on-change-repository-password="($ctrl.onChangeRepositoryPassword)"
    on-change-new-credential-name="($ctrl.onChangeNewCredentialName)"
    show-auth-explanation="true"
  ></git-form-auth-fieldset>
  <environment-variables-panel
    ng-model="$ctrl.formValues.Env"
    explanation="These values will be used as substitutions in the stack file"
    on-change="($ctrl.onChangeEnvVar)"
    show-help-message="true"
  ></environment-variables-panel>
  <div ng-if="$ctrl.stack.Type === 1 && $ctrl.endpoint.apiVersion >= 1.27">
    <div class="col-sm-12 form-section-title"> Options </div>
    <div class="form-group">
      <div class="col-sm-12">
        <por-switch-field
          name="prune"
          checked="$ctrl.formValues.Option.Prune"
          tooltip="'Prune services that are no longer referenced.'"
          label-class="'col-sm-3 col-lg-2'"
          label="'Prune services'"
          on-change="($ctrl.onChangeOption)"
        ></por-switch-field>
      </div>
    </div>
  </div>
  <button
    class="btn btn-sm btn-primary"
    ng-click="$ctrl.submit()"
    ng-disabled="$ctrl.isSubmitButtonDisabled() || $ctrl.state.hasUnsavedChanges || !$ctrl.redeployGitForm.$valid"
    style="margin-top: 7px; margin-left: 0"
    button-spinner="$ctrl.state.redeployInProgress"
    analytics-on
    analytics-event="docker-stack-pull-redeploy"
    analytics-category="docker"
  >
    <span ng-hide="$ctrl.state.redeployInProgress"> <i class="fa fa-sync space-right" aria-hidden="true"></i> Pull and redeploy </span>
    <span ng-show="$ctrl.state.redeployInProgress">In progress...</span>
  </button>
  <button
    class="btn btn-sm btn-primary"
    ng-click="$ctrl.saveGitSettings()"
    ng-disabled="$ctrl.isSubmitButtonDisabled() || !$ctrl.state.hasUnsavedChanges || !$ctrl.redeployGitForm.$valid || ($ctrl.formValues.RepositoryAuthentication && (!$ctrl.formValues.RepositoryPassword && $ctrl.formValues.RepositoryGitCredentialID===0)) || ($ctrl.formValues.RepositoryAuthentication && $ctrl.formValues.RepositoryPassword && $ctrl.formValues.SaveCredential && (!$ctrl.formValues.NewCredentialName || $ctrl.formValues.NewCredentialNameExist || $ctrl.formValues.NewCredentialNameInvalid))"
    style="margin-top: 7px; margin-left: 0"
    button-spinner="$ctrl.state.inProgress"
    analytics-on
    analytics-event="docker-stack-update-git-settings"
    analytics-category="docker"
    analytics-properties="$ctrl.buildAnalyticsProperties()"
  >
    <span ng-hide="$ctrl.state.inProgress"> Save settings </span>
    <span ng-show="$ctrl.state.inProgress">In progress...</span>
  </button>
</form>
